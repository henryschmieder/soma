<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<title>soma | scalable javascript framework | soundstep.com</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
	<meta name="description" content="soma is a javascript scalable framework that is meant to help developers to write loosely-coupled applications to increase scalability and maintainability.">
	<meta name="keywords" content="soma1 js javascript framework mvc somacore soundstep design pattern events tools toolset html css ria mobile desktop prototype loose-coupling model view controller native development">
	<link rel="icon" type="image/png" href="favicon.png">
	<link href="assets/styles/prism.css" rel="stylesheet" />
	<link rel="stylesheet" href="assets/gh-buttons/gh-buttons.css">
	<link rel="stylesheet" href="assets/styles/pygment/native.css">
	<link rel="stylesheet" href="assets/styles/styles.css">

	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>

	<script src="assets/js/libs/prism.js"></script>
	<script src="assets/js/libs/respond.js"></script>
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<link rel="shortcut icon" href="../assets/common/images/favicon.ico">
	<link rel="apple-touch-icon" href="../assets/common/images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="../assets/common/images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="../assets/common/images/apple-touch-icon-114x114.png">

	<script type="text/javascript">

		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-36294101-3']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

	</script>

</head>
<body>

<div class="wrapper">
	<header>
		<h1><a href="./">soma</a></h1>

		<p>Scalable javascript framework</p>

		<ul>
			<li><a href="https://github.com/soundstep/soma/zipball/master">Download <strong>ZIP File</strong></a></li>
			<li><a href="https://github.com/soundstep/soma/tarball/master">Download <strong>TAR Ball</strong></a></li>
			<li><a href="https://github.com/soundstep/soma">View On <strong>GitHub</strong></a></li>
		</ul>

	</header>

	<div id="navigation">
		<nav>
			<ul>
				<li><a href="#what-is-soma">What is soma?</a></li>
				<li><a href="#requirements">Requirements</a></li>
				<li><a href="#download">Download</a></li>
				<li><a href="#quick-start">Quick start</a></li>
				<li><a href="#application-instance">Application instance</a></li>
				<li><a href="#core-elements">Core elements</a></li>
				<li>
					<p><a href="#dependency-injection">Dependency injection</a><p>
					<ul class="hidden">
						<li><a href="#what-is-dependency-injection">What is dependency injection?</a></li>
						<li><a href="#using-dependency-injection-in-somajs">Using dependency injection in soma</a></li>
						<li><a href="https://github.com/soundstep/infuse" target="_blank">infuse</a></li>
					</ul>
				</li>
				<li><p><a href="#communication">Communication</a></p>
					<ul class="hidden">
						<li><a href="#event-system">Event system</a></li>
						<li><a href="#creating-and-dispatching-events">Creating and dispatching events</a></li>
						<li><a href="#listening-to-events">Listening to events</a></li>
						<li><a href="#removing-listeners">Removing listeners</a></li>
						<li><a href="#send-parameters">Send parameters</a></li>
						<li><a href="https://millermedeiros.github.io/js-signals/" target="_blank">signals</a></li>
					</ul>
				</li>
				<li><p><a href="#command">Command</a></p>
					<ul class="hidden">
						<li><a href="#create-commands">Create commands</a></li>
						<li><a href="#manage-commands">Manage commands</a></li>
						<li><a href="#simple-command-example">Simple command example</a></li>
						<li><a href="#flow-control">Flow control</a></li>
					</ul>
				</li>
				<li><p><a href="#mediator">Mediator</a></p>
					<ul class="hidden">
						<li><a href="#create-mediators">Create mediators</a></li>
						<li><a href="#simple-mediator-example">Simple mediator example</a></li>
						<li><a href="#decoupling-communication">Decoupling communication</a></li>
					</ul>
				</li>
				<li><p><a href="#oop">OOP</a></p>
					<ul class="hidden">
						<li><a href="#inheritance">Inheritance</a></li>
						<li><a href="#extend-method-shortcut">Extend method shortcut</a></li>
						<li><a href="#call-super-constructor-and-methods">Call super constructors and methods</a></li>
					</ul>
				</li>
				<li><p><a href="#plugins">Plugins</a></p>
					<ul class="hidden">
						<li><a href="#create-a-plugin">Create a plugin</a></li>
						<li><a href="#mouse-plugin">Mouse plugin</a></li>
						<li><a href="#ready-plugin">Ready plugin (auto-regitration)</a></li>
						<li><a href="#orientation-plugin">Orientation plugin</a></li>
					</ul>
				</li>
				<li><a href="#router">Router</a></li>
				<li><a href="#demos">Demos</a></li>
				<li><a href="#tools">Tools</a></li>
				<li><a href="#tests">Tests</a></li>
				<li><a href="https://groups.google.com/forum/#!forum/somajs" target="_blank">Questions</a></li>
				<li><a href="#browser-support">Browser support</a></li>
		</nav>
		<footer>
			<p>
				<a href="https://twitter.com/soundstep" target="_blank">@soundstep</a><br/>
				<a href="http://www.soundstep.com" target="_blank">www.soundstep.com</a>
			</p>

			<p>
				<small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a>
				</small>
			</p>
		</footer>
	</div>

	<section>

		<div class="title">
			<h1>What is soma?</h1>
			<a class="anchor" name="what-is-soma"></a>
		</div>

		<p>soma is a framework created to build scalable and maintainable javascript applications.</p>

		<p>The success to build large-scale applications will rely on smaller single-purposed parts of a larger system. soma provides tools to create a <a href="http://en.wikipedia.org/wiki/Loose_coupling" target="_blank">loosely-coupled</a> architecture broken down into smaller pieces.</p>
		<p>The different components of an application can be modules, models, views, plugins or widgets. soma will not dictate its own structure, the framework can be used as a <a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" target="_blank">model-view-controller</a> framework, can be used to create independent modules, sandboxed widgets or anything that will fit a specific need.</p>
		<p>For a system to grow and be maintainable, its parts must have a very limited knowledge of their surrounding. The components must not be tied to each other (<a href="http://en.wikipedia.org/wiki/Law_of_Demeter" target="_blank">Law of Demeter</a>), in order to be re-usable, interchangeable and allow the system to scale up.</p>
		<p>soma is a set of tools and design patterns to build a long term architecture that are decoupled and easily testable. The tools provided by the framework are <a href="http://en.wikipedia.org/wiki/Dependency_injection" target="_blank">dependency injection</a>, <a href="http://en.wikipedia.org/wiki/Observer_pattern" target="_blank">observer pattern</a>, <a href="http://en.wikipedia.org/wiki/Mediator_pattern" target="_blank">mediator pattern</a>, <a href="http://en.wikipedia.org/wiki/Facade_pattern" target="_blank">facade pattern</a>, <a href="http://en.wikipedia.org/wiki/Command_pattern" target="_blank">command pattern</a>, <a href="http://en.wikipedia.org/wiki/Object-oriented_programming" target="_blank">OOP</a> utilities and a DOM manipulation template engine as an optional plugin.</p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Requirements</h1>
			<a class="anchor" name="requirements"></a>
		</div>

		<p>Soma requires two other libraries:</p>
		<ul>
			<li><a href="https://www.npmjs.com/package/@soundstep/infuse" target="_blank" rel="noopener noreferrer">infuse (dependency injection)</a></li>
			<li><a href="https://millermedeiros.github.io/js-signals/" target="_blank" rel="noopener noreferrer">signals (pub-sub)</a></li>
		</ul>

		<pre><code class="language-shell">npm install @soundstep/infuse
npm install signals</code></pre>

	</section>

	<section>

		<div class="title">
			<h1>Download</h1>
			<a class="anchor" name="download"></a>
		</div>

		<h3>Install using NPM</h3>

		<pre><code class="language-shell">npm install @soundstep/soma</code></pre>
		<pre><code class="language-js">const soma = require('@soundstep/soma');</code></pre>
		<div class="back"><a href="#">top</a></div>
		<h3>Browser</h3>
		<p>soma minified and gzip is 2.2 KB.</p>
		<p><a href="https://github.com/soundstep/soma/tree/master/dist" class="button icon tag" target="_blank">download soma</a></p>
		<p>Add the script to your page:</p>
		<script type="text/plain" class="language-html"><script type="text/javascript" src="soma.js">&lt;/script></script>

	</section>

	<section>

		<div class="title">
			<h1>Quick start</h1>
			<a class="anchor" name="quick-start"></a>
		</div>

		<p>Here is an example of what a soma application could look like. In this case, following the MVC pattern.</p>
		<p>The application contains a model that holds data, a template that manipulate a DOM element and an application instance that hook them up. The application instance must extend a framework function (<code>soma.Application</code>), while the other entities (model and template) are plain javascript function free of framework code.</p>
		<p>The template function receives a template instance, a DOM element and the model, using dependency injection.</p>

		<script type="text/plain" class="language-html"><div class="app"></div>

<script>

	// function model containing data (text to display)
	const Model = function() {
		this.data = "Hello world!"
	};

	// command to update the DOM
	const UpdateDOM = function(model) {
		this.execute = () => {
			document.querySelector('.app').innerHTML = model.data;
		};
	}

	// application
	const QuickStartApplication = soma.Application.extend({
		init: function() {
			// model mapping rule so it can be injected in the template
			this.injector.mapClass("model", Model, true);
			// create a template for a specific DOM element
			this.commands.add('update-dom', UpdateDOM);
		},
		start: function() {
			this.emitter.dispatch('update-dom');
		}
	});

	// create application
	var app = new QuickStartApplication();
	app.start();

&lt;/script></script>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-quick-start?lite=true#script.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Application instance</h1>
			<a class="anchor" name="application-instance"></a>
		</div>

		<p>The first step to build a soma application is to create an application instance. This is the only moment a framework function has to be extended, all the other entities can be re-usable plain javascript function, and framework agnostic.</p>
		<p>The application instance will execute two functions so you can setup the architecture needed: the init and the start functions.</p>
		<p>Here are different syntax to create an application instance.</p>

		<pre><code class="language-js">const MyApplication = soma.Application.extend({
	init: function() {
		console.log('init');
	}
});

const app = new MyApplication();</code></pre>

<pre><code class="language-js">const MyApplication = soma.Application.extend();

MyApplication.prototype.init = function() {
	console.log('init');
};

const app = new MyApplication();</code></pre>

<pre><code class="language-js">class MyApplication extends soma.Application {
	init() {
		console.log('init');
	}
}

const app = new MyApplication();</code></pre>

		<p>The constructor of an application can be overridden to implement your own. The "parent" constructor will have to be called so the framework can bootstrap. Click here to <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/call" target="_blank">learn more about chaining constructor</a>.</p>

		<pre><code class="language-js">const MyApplication = soma.Application.extend({
	constructor: function(param) {
		this.param = param;
		soma.Application.call(this);
	},
	init: function() {
		console.log('init with param:', this.param);
	}
});

const app = new MyApplication('my application parameter');</code></pre>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Core elements</h1>
			<a class="anchor" name="core-elements"></a>
		</div>

		<p>The framework core elements to help you build your own structure are the following:</p>
		<ul>
			<li>Dependency injection (<code>injector</code> property)</li>
			<li>Observer pattern (<code>emitter</code> property)</li>
			<li>Command pattern (<code>commands</code> property)</li>
			<li>Mediator pattern (<code>mediators</code> property)</li>
			<li>Facade pattern (<code>instance</code> property)</li>
		</ul>
		<p>They are available in the application or in other entities using dependency injection.</p>
		<p>Here is how to get their references in the application instance.</p>

		<pre><code class="language-js">const MyApplication = soma.Application.extend({
	init: function() {
		this.injector; // dependency injection pattern
		this.emitter; // observer pattern
		this.commands; // command pattern
		this.mediators; // mediator pattern
		this.instance; // facade pattern
	}
});</code></pre>

		<p>Here are two different syntax to get their references in other entities. The injector will either send the core elements in the constructor or set the corresponding properties.</p>

		<pre><code class="language-js">const Entity = function(injector, emitter, commands, mediators, instance) {

};</code></pre>

		<pre><code class="language-js">const Entity = function() {
	this.injector = null;
	this.emitter = null;
	this.commands = null;
	this.mediators = null;
	this.instance = null;
};</code></pre>

		<p>Note: in case of injected variables (versus constructor parameters), it is necessary to set properties to a value (such as null), <code>undefined</code> properties are ignored by the injector.</p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Dependency injection</h1>
			<a class="anchor" name="dependency-injection"></a>
		</div>

		<p><a href="https://github.com/soundstep/infuse" target="_blank">infuse</a> is the dependency injection library developed for soma, <a href="https://github.com/soundstep/infuse" target="_blank">click here to see the infuse documentation and tests</a>.</p>

		<div class="subtitle">
			<h2>What is dependency injection?</h2>
			<a class="anchor" name="what-is-dependency-injection"></a>
		</div>

		<p><a href="http://en.wikipedia.org/wiki/Dependency_injection" target="_blank">Dependency injection</a> (DI) and <a href="http://en.wikipedia.org/wiki/Inversion_of_control" target="_blank">inversion of control</a> (IOC) are two terms often used in programming. Before explaining the benefits of dependency injection and how it is implemented in soma, here is a naive and hopefully accessible explanation.</p>

		<p>A dependency is the relationships between two objects. This relationship is often characterized by side effects that can be problematic and undesirable at times.</p>
		<p>Dependency injection is the process in which you are setting up rules that determine how dependencies are injected into an object automatically, as opposed to have hard-coded dependencies.</p>
		<p>An object "A" that needs an object "B" to work has a direct dependency to it. Code where the components are dependent on nearly everything else is a "highly-coupled code". The result is an application that is hard to maintain, with components that are hard to change without impacting on others.</p>
		<p>Dependency injection is an antidote for highly-coupled code. The cost required to wire objects together falls to next to zero.</p>
		<p>Dependency Injection is based on the following assumptions:</p>
		<ul>
			<li>Tight coupling of object implementations is always bad. </li>
			<li>A dependent function is never a good place to create a dependency.</li>
		</ul>
		<p>Consider the process of using the dependency injection pattern as centralizing knowledge of all dependencies and their implementations.</p>
		<p>A common dependency injection system has a separate object (an injector, often called container), that will instantiate new objects and populate them with what they needs: the dependencies. Dependency injection is a useful pattern to solve nested dependencies, as they can chain and be nested through several layers of the application.</p>
		<p>The benefits of dependency injection are:</p>
		<ul>
			<li>More re-usable components.</li>
			<li>Improved code maintenance.</li>
			<li>More testable components (mocking object).</li>
			<li>More readable code (reduction of boilerplate code).</li>
		</ul>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Using dependency injection in soma</h2>
			<a class="anchor" name="using-dependency-injection-in-somajs"></a>
		</div>

		<p>Dependency injection involves a way of thinking called the <a href="http://en.wikipedia.org/wiki/Hollywood_principle" target="_blank">Hollywood principle</a> "don't call us, we'll call you". This is exactly how it works in soma. Entities will ask for their dependencies using properties and/or constructor parameters.</p>
		<p>Using dependency injection implies creating rules, so the injector knows "what" and "how" to populate the dependencies.</p>
		<p>These are called "mapping rules". A rule is simply "mapping" a name (string) to an "object" (string, number, boolean, function, object, and so on). These mapping names are used to inject the corresponding objects in either a javascript constructor or a variable.</p>

		<div>
			<h4>A simple example</h4>
		</div>

		<p>In the following example, two plain javascript functions will be instantiated and injected.</p>
		<ul>
			<li>The <code>Config</code> function has a <code>debugMode</code> constructor parameter that happened to be an injection name (mapping rule associated), the corresponding boolean value will be injected into it.</li>
			<li>The <code>Model</code> function contains two constructor parameters that also are injection names. A config instance and a boolean value will be injected into the corresponding parameters.</li>
			<li>Two mapping rules are defined, one using the <code>mapClass</code> method used to map functions and one using the <code>mapValue</code> method used to map objects that are not meant to be instantiated.</li>
			<li>In the last line, the Model instance is instantiated by the injector, which will take care of all the dependencies and nested dependencies needed.</li>
		</ul>

		<pre><code class="language-js">// simple function that will be injected into the model
// a boolean dependency is injected
const Config = function(debugMode) {
	console.log('debugMode injected in Config:', debugMode);
};

// simple function in which a config instance and a boolean is injected
const Model = function(debugMode, config) {
	console.log('debugMode injected in Model:', debugMode);
	console.log('config injected in Model:', config);
};

// function model containing data (text to display)
const MyApplication = soma.Application.extend({
	init: function() {
		// mapping rule: map the string 'config' to the function Config
		this.injector.mapClass('config', Config);
		// mapping rule: map the string 'debugMode' to a boolean
		this.injector.mapValue('debugMode', true);
		// instantiate the model using the injector
		this.start();
	},
	start: function() {
		const model = this.injector.createInstance(Model);
	}
});

var app = new MyApplication();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-simple-example?lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div>
			<h4>Singleton injection</h4>
		</div>

		<p>By default, every single time the injector will find a dependency that needs to be instantiated (such as the <code>Config</code> function in the previous example), the injector will instantiate a new one. A third parameter can be used when defining the <code>mapClass</code> rule: the "singleton" parameter.</p>
		<p>The effect will be that the injector will instantiate the function the first time it is asked, and send that same instance when it is asked again. This is useful to share an instance with several other components.</p>

		<pre><code class="language-js">this.injector.mapClass('config', Config, true);</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-singleton-injection?lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div>
			<h4>Where can injection be used?</h4>
		</div>

		<p>Injection can be used in any function instantiated by the injector:</p>
		<ul>
			<li>Entities manually created using the injector</li>
			<li>Dependencies of entities as they are automatically created by the injector</li>
			<li>Commands as they are internally created by the injector</li>
			<li>Mediators as they are internally created by the injector</li>
			<li>Templates as they are internally created by the injector</li>
		</ul>

		<p>In the following example, dispatching an event will instantiate and execute a <code>Command</code> function, which will instantiate a <code>Model</code> function as it needs this dependency, which will instantiate a <code>Config</code> function as it needs this dependency.</p>

		<pre><code class="language-js">const Config = function() {
	console.log('Config instantiated');
};

const Model = function(config) {
	console.log('Model instantiated with a config injected:', config);
};

const Command = function(model) {
	this.execute = function() {
		console.log('Command executed with a model injected:', model);
	}
};

const MyApplication = soma.Application.extend({
	init: function() {
		// mapping rule: map the string 'config' to the function Config
		this.injector.mapClass('config', Config, true);
		// mapping rule: map the string 'model' to the function Model
		this.injector.mapClass('model', Model, true);
		// command mapped to an event
		this.commands.add('some-event', Command);
		// start
		this.start();
	},
	start: function() {
		// send a command
		this.emitter.dispatch('some-event');
	}
});

const app = new MyApplication();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-simple-injection>lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Communication</h1>
			<a class="anchor" name="communication"></a>
		</div>

		<p><a href="https://millermedeiros.github.io/js-signals/" target="_blank">signals</a> is the pub-sub library developed for soma.</p>

		<div class="subtitle">
			<h2>Event system (signals)</h2>
			<a class="anchor" name="event-system"></a>
		</div>

		<p>Communicating between entities in an application is an important part.
			Object orientated programming is all about states of objects and their interaction.
			Certain objects need to be informed about changes in others objects, some others need to inform the rest of
			the application and some others will do both.</p>
		<p>The <a href="http://en.wikipedia.org/wiki/Observer_pattern" target="_blank">Observer pattern</a> is a
			design pattern used to communicate between objects and reduce the dependencies. One the core
			elements of soma is the "emitter", an event system used to dispatch and listen to events throughout
			the entire application.</p>
		<p>For example, a model component that receives data can use the dispatcher to notify the rest
			of the application that the data has changed. A view component can use the dispatcher to inform
			other components that a user input has just happened.</p>
		<p>Soma is using an underlying library for its event system called
			<a href="https://millermedeiros.github.io/js-signals/" target="_blank">signals</a>,
			which is a "pub-sub" library (publish-subscribe). Signals have been created for specific reasons, and
			provide a powerful alternative to issues that can occur with standard DOM 3 Event, more information
			<a href="https://github.com/millermedeiros/js-signals/wiki/Comparison-between-different-Observer-Pattern-implementations" target="_blank" rel="noopener noreferrer">there</a>.</p>

		<p>Signals are very powerful, here are a few thing you can do:</p>
		<ul>
			<li>Single Listener</li>
			<li>Multiple Listeners</li>
			<li>Multiple Dispatches</li>
			<li>Multiple Dispatches + addOnce</li>
			<li>Enable / Disable Signal</li>
			<li>Stop / Halt Propagation</li>
			<li>Set execution context of the listener handler</li>
			<li>Set listener priority / order</li>
			<li>Enable / Disable a single SignalBinding</li>
			<li>Manually execute a signal handler</li>
			<li>Retrieve anonymous listener</li>
			<li>Remove / Detach anonymous listener</li>
			<li>Check if binding will execute only once</li>
			<li>Change listener execution context on-the-fly</li>
			<li>Add default parameters to Signal dispatch</li>
			<li>Check if Signal has specific listener</li>
			<li>Memorize previously dispatched values / forget values</li>
			<li>Listening for multiple signals at once</li>
			<li>Dispatching arbitrary events</li>
		</ul>

		<p>Find out more in the <a href="https://github.com/millermedeiros/js-signals/wiki/Examples" target="_blank">Signals examples</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Creating and dispatching events</h2>
			<a class="anchor" name="creating-and-dispatching-events"></a>
		</div>

		<div>
			<h4>Create and dispatch an event using the dispatcher</h4>
		</div>

		<p>Creating an event and dispatching it with the dispatcher is very simple.</p>

		<pre><code class="language-js">const MyApplication = soma.Application.extend({
	init: function() {
		this.start();
	},
	start: function() {
		// listen to an event
		this.emitter.addListener('some-event', this.handler);
		// dispatch an event
		this.emitter.dispatch('some-event', ['my parameter']);
		// cleanup
		this.emitter.removeListener('some-event', this.handler);
	},
	handler: function(param) {
		console.log('event received with:', param);
	}
});

const app = new MyApplication();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-dispatch-event?lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Listening to events</h2>
			<a class="anchor" name="listening-to-events"></a>
		</div>

		<p>The "emitter" implements the same interface as the signals, the methods
			"addListener" and "removeListener" can be used to listen and stop listening to events.</p>

		<p>The signals used by the "emitter" can be retrieved using the "getSignal" method.</p>

		<div><h4>A simple example</h4></div>

		<p>In the following example, an event is dispatched from the application instance, and listened to both in the application instance and a view.</p>

		<pre><code class="language-js">const View = function(emitter) {
const handler = () => console.log('event received in a view');
	emitter.addListener('some-event', handler);
}

const MyApplication = soma.Application.extend({
	init: function() {
		this.injector.createInstance(View);
		this.start();
	},
	start: function() {
		// listen to an event
		this.emitter.addListener('some-event', this.handler);
		// dispatch an event
		this.emitter.dispatch('some-event');
	},
	handler: function() {
		console.log('event received in the app');
	}
});

const app = new MyApplication();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-listen-to-events?lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div><h4>Event handlers scope and binding</h4></div>

		<p>As with events dispatched from the DOM and handler callback function in general,
			the scope of the functions (this) might not be the expected scope.
			To solve this common javascript problem, the "scope" of the signals can be used (preferred way), or the javascript "bind" method.</p>
		<p><code>Function.prototype.bind</code> is part of ECMAScript 5 and soma has implemented a shim
			for older browsers.
			<a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/bind" target="_blank">Click here for more information about the bind method</a>.</p>
		<p>In the following example, one event is dispatched and two functions are listening to it.
			In the first function, the "this" is the window. In the second function the "this" is the
			application instance as the bind function changes the scope of the event handler, making the
			instance variable accessible.</p>

		<pre><code class="language-js">const MyApplication = soma.Application.extend({
	init: function() {
		// instance variable
		this.myVariable = "myValue";
		// listen to an event without binding
		this.emitter.addListener('some-event', function() {
			// "this" is the window (or global with nodejs)
			console.log('instance variable not accessible:', this.myVariable);
		});
		// listen to an event using the signals scope
		this.emitter.addListener('some-event', function() {
			// "this" is the application instance
			console.log('instance variable accessible:', this.myVariable);
		}, this);
		// listen to an event using bind method
		this.emitter.addListener('some-event', function() {
			// "this" is the application instance
			console.log('instance variable accessible:', this.myVariable);
		}.bind(this));
		// start
		this.start();
	},
	start: function() {
		this.emitter.dispatch('some-event');
	}
});

const app = new MyApplication();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-event-binding?lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="subtitle">
			<h2>Removing listeners</h2>
			<a class="anchor" name="removing-listeners"></a>
		</div>

		<p>Listeners can be removed using the emitter, the signal instance of an event, or the binding of a listener.</p>

		<pre><code class="language-js">const MyApplication = soma.Application.extend({
	init: function() {

		// retrieve a binding
		const binding = this.emitter.addListener('some-event', this.handler, this);

		// retrieve a signal
		const signal = this.emitter.getSignal('some-event');

		// dispatch the first event
		this.emitter.dispatch('some-event');

		// Remove the listener using the emitter
		// the same scope is needed to properly remove the listener
		this.emitter.removeListener('some-event', this.handler, this);

		// remove the listener using the binding
		binding.detach();

		// remove the listener using the signal
		// the same scope is needed to properly remove the listener
		signal.remove(this.handler, this);

		// dispastch another event
		this.emitter.dispatch('some-event'); // will not be received
	},
	handler: function() {
		console.log('received event');
	}
});

const app = new MyApplication();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-remove-event-listener?lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<p>An important note about removing listeners.</p>

		<p>The bind method creates a new function, and so is the scope of a signal,
			removing a listener using the bind method will not work as the event handler will be a new function.</p>

		<p>The preferred way is to use the "scope" (called context for a signal)
			instead of using the javascript "bind" method, the third parameter of the "addListener" and "removeListener" method.</p>

		<pre><code class="language-js">emitter.addListener('event', handler, this);
emitter.removeListener('event', handler, this);</code></pre>

		<p>If you still wish to use the javascript "bind" method, a "bound" function should be used to properly remove the listener.</p>

		<pre><code class="language-js">// event handler
const eventHandler = function() {
	// will not be triggered as the listener is properly removed
}
// bound event handler reference
const boundEventHandler = eventHandler.bind(this);
// listen to an event
this.emitter.addListener('some-event', boundEventHandler);
// stop listening to an event
this.emitter.removeListener('some-event', boundEventHandler);</code></pre>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Send parameters</h2>
			<a class="anchor" name="send-parameters"></a>
		</div>

		<p>Parameters can be sent when dispatching events, so the events handlers can receive information. The parameters are store on the <code>event.params</code> property of an event.</p>

		<pre><code class="language-js">emitter.dispatch('some-event', ['param1', {data:'another'}, true, 12]);</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-send-event-parameters?lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Command</h1>
			<a class="anchor" name="command"></a>
		</div>

		<p>A <a href="http://en.wikipedia.org/wiki/Command_pattern" target="_blank">command</a> is behavioral design pattern to help reducing dependencies. An object is used to encapsulate the information needed to call a method, including the object owning the method, the object itself and any parameters.</p>
		<p>Concretely, a command is a function instantiated by the framework, created for any re-usable action that could be performed in various places of the application. A command is meant to be created, used and discarded straight away. A command should never be used to hold data, and should be executable at any time without causing errors in the system.</p>

		<div class="subtitle">
			<h2>Create commands</h2>
			<a class="anchor" name="create-commands"></a>
		</div>

		<p>A command in soma is nothing more than a simple function that contains an <code>execute</code> method that will receive the event instance used to trigger it. Dependency injection can be used to retrieve useful objects.</p>

		<pre><code class="language-js">var Command = function(myModel, myView) {
	this.execute = function(event) {
		// do something
	}
};</code></pre>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Manage commands</h2>
			<a class="anchor" name="manage-commands"></a>
		</div>

		<div><h4>Add a command</h4></div>

		<p>Commands in soma are triggered using events. This makes possible for the application actors to, not only execute commands, but also listen to events used to trigger the commands.</p>
		<p>The <code>commands</code> core element is used to managed the commands. It is a good practice, unless you are building self-contained modules, to add all the commands in the same place, such as the application instance. This would give a good overview for a potential new developer to get an idea of what is possible to do in the application using the commands.</p>

		<pre><code class="language-js">this.commands.add("some-event", Command);</code></pre>

		<div><h4>Remove a command</h4></div>

		<p>The <code>commands</code> core element contains several useful methods to manage the commands, such as <code>has</code>, <code>get</code> and <code>getAll</code>. To remove a command, the <code>remove</code> method can be used.</p>

		<pre><code class="language-js">this.commands.remove("some-event");</code></pre>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>A simple command example</h2>
			<a class="anchor" name="simple-command-example"></a>
		</div>

		<p>The following example contains a <code>Navigation</code> model, its role is to display a screen using an ID. A Command is created to call the navigation method. The command is mapped to a "show-screen" event, which is used to send the ID of a screen. This setup makes possible, for any actor of the application, to dispatch an event to show a screen.</p>

		<pre><code class="language-js">const Navigation = function() {}
Navigation.prototype.showScreen = function(screenId) {
	console.log('Display screen:', screenId);
};

const Command = function(navigation) {
	this.execute = function(screenId) {
		console.log('Command executed with parameter:', screenId);
		navigation.showScreen(screenId);
	}
};

const MyApplication = soma.Application.extend({
	init: function() {
		this.injector.mapClass('navigation', Navigation, true);
		this.commands.add('show-screen', Command);
		this.start();
	},
	start: function() {
		this.emitter.dispatch('show-screen', ['home']);
	}
});

const app = new MyApplication();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-command-example?lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Flow control</h2>
			<a class="anchor" name="flow-control"></a>
		</div>

		<p>Being able to control the flow of an application is important. Some components might decide to execute a command, but some other components might have the need to monitor or even interrupt the application flow. A good example could be a "logout" command in an editor application. A menu component can decide to execute this command, but the editor should be able to intercept and interrupt it in case the user didn't save his current file.</p>
		<p>As the commands are using events to be triggered, the DOM Event provides the necessary tools to monitor (addListener) and interrupt a command (event.preventDefault).</p>
		<p>In the following example, a command is executed and an external <code>Monitor</code> entity is able to monitor this command by listening to the event.</p>

		<pre><code class="language-js">const Monitor = function(emitter) {
	emitter.addListener('some-event', function() {
		console.log('Command monitored');
	});
};

const Command = function() {
	this.execute = function() {
		console.log('Command executed');
	}
};

const MyApplication = soma.Application.extend({
	init: function() {
		this.injector.createInstance(Monitor);
		this.commands.add('some-event', Command);
		this.start();
	},
	start: function() {
		this.emitter.dispatch('some-event');
	}
});

const app = new MyApplication();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-command-flow?lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<p>In the following example, the <code>start</code> method dispatch an event to logout a user. The <code>EditorModel</code> is able to monitor the logout command and interrupt it.</p>
		<p>The initiator of the command can decide when dispatching the event, if another component should be able to interrupt it. A DOM Event has a <code>cancelable</code> property that should be set to true when dispatched so another component can interrupt it using the <code>event.preventDefaut()</code> method.</p>

		<pre><code class="language-js">const EditorModel = function(emitter) {
	emitter.addListener('logout', function() {
		const signal = emitter.getSignal('logout');
		console.log('Logout event received in EditorModel');
		if (!this.fileSaved) {
			console.log('Interupt logout command');
			signal.halt();
		}
	});
};

const LogoutCommand = function() {
	this.execute = function(event) {
		console.log('Logout user');
	}
};

const EditorApplication = soma.Application.extend({
	init: function() {
		this.injector.createInstance(EditorModel);
		this.commands.add('logout', LogoutCommand);
		this.start();
	},
	start: function() {
		this.emitter.dispatch('logout');
	}
});

const app = new EditorApplication();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-command-interrupt?lite=true#index.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Mediator</h1>
			<a class="anchor" name="mediator"></a>
		</div>

		<p>A mediator is a behavioral design pattern that is used to reduce dependencies. Concretely, a mediator is an object that represents another object, the communication between objects can be encapsulated within the mediators rather than the objects it represents, reducing coupling.</p>

		<div class="subtitle">
			<h2>Create mediators</h2>
			<a class="anchor" name="create-mediators"></a>
		</div>

		<p>The core element <code>mediators</code> can be used to create mediators. It contains a single <code>create</code> method as the mediators and objects represented are not stored by the framework.</p>
		<p>The <code>create</code> method requires two parameters. The first parameter is a function instantiated by the framework, the mediator itself. The second parameter is either a single object or a list of objects (array, node list, and so on).</p>
		<p>Mediators are also useful to represent several targets with the same function (<a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself" target="_blank">DRY</a>). The <code>create</code> method will instantiate as many mediators needed and return them.</p>
		<p>A <code>target</code> parameter will be injected to get a reference of the object represented.</p>

		<pre><code class="language-js">function MyMediator = function(target) {
	// target is the object represented
};
// create mediator with a single object
var mediators = mediators.create(object, MyMediator);
// create mediator with a list of objects
var mediators = mediators.create([object1, object2, object3], MyMediator);</code></pre>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Simple mediator example</h2>
			<a class="anchor" name="simple-mediator-example"></a>
		</div>

		<p>In the following example, a mediator that represents a DOM Element is created, paradoxically called "view" on purpose (see next example).</p>
		<p>The mediator updates its target, a DOM Element, when it receives a specific event.</p>

		<pre><code class="language-js">const TitleView = function(target, emitter) {
	// listen to the event 'render-title' to update the target (DOM Element)
	emitter.addListener('render-title', function(title) {
		target.innerHTML = title;
	});
};

const Application = soma.Application.extend({
	init: function() {
		// create a mediator that represents a DOM Element
		this.mediators.create(document.getElementById('title'), TitleView);
		this.start();
	},
	start: function() {
		// dispatch an event to trigger an action in the mediator
		this.emitter.dispatch('render-title', ['This is a title']);
	}
});

const app = new Application();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-mediator-example?lite=true#script.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Decoupling communication</h2>
			<a class="anchor" name="decoupling-communication"></a>
		</div>

		<p>The previous example can be taken even further to create a highly re-usable object. The goal is to create a view that is only a DOM Element wrapper and stripped off any framework and communication code. The view can provide a set of methods to update its content, and the communication with the framework can be moved to another mediator.</p>
		<p>Responsibilities will be completely separated as the view will only take care of displaying content, and the mediator will be responsible of providing the view the right content, at the right moment. The result are components that are highly decoupled and more maintainable.</p>
		<p>The following example also show how to use a single view function and a single mediator function, to handle multiple DOM Elements.</p>

		<pre><code class="language-js">// model containing data
const TitleModel = function() {
	this.data = {
		first: 'First title',
		second: 'Second title',
		third: 'Third title'
	};
};
TitleModel.prototype.getTitle = function(id) {
	return this.data[id];
};

// view representing a DOM element
const TitleView = function(target) {
	this.element = target;
};
TitleView.prototype.setTitle = function(value) {
	this.element.innerHTML = value;
};

// mediator representing a view
const TitleMediator = function(target, emitter, model) {
	emitter.addListener('render-title', function() {
		const id = target.element.getAttribute('data-id');
		const title = model.getTitle(id);
		target.setTitle(title);
	});
};

const Application = soma.Application.extend({
	init: function() {
		// map model to inject in mediators
		this.injector.mapClass('model', TitleModel, true);
		// convert a NodeList to an array of DOM elements
		const list = Array.from(document.querySelectorAll('h2'));
		// create views (mediators representing DOM elements)
		const views = this.mediators.create(list, TitleView);
		// create mediators (mediators representing a view)
		const mediators = this.mediators.create(views, TitleMediator);
		this.start();
	},
	start: function() {
		// dispatch an event to render the titles
		this.emitter.dispatch('render-title');
	}
});

const app = new Application();</code></pre>

		<p><a href="https://replit.com/@RomualdQuantin/Soma-mediator-decoupling?lite=true#script.js" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>OOP</h1>
			<a class="anchor" name="oop"></a>
		</div>

		<p>Javascript is an object oriented language, but do not have built-in classes, private members, inheritance, interfaces and other common features found in other languages.</p>
		<p>There are a lot of debates whether you should emulate classes, but the fact is, some inheritance capabilities are sometimes needed not to duplicate code (<a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself" target="_blank">DRY principle</a>).</p>
		<p>Inheritance is very useful in many cases but must not be overused, <a href="http://en.wikipedia.org/wiki/Composition_over_inheritance" target="_blank">composition over inheritance</a> is usually a better design in the long term. The solution is using the right pattern for the right problem.</p>
		<p>soma provides some useful utility functions to emulate inheritance.</p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Inheritance</h2>
			<a class="anchor" name="inheritance"></a>
		</div>

		<p>In the following example, a function <code>Person</code> is created, along with a <code>say</code> method. A second function <code>Man</code> is created and inherits from its parent.</p>
		<p>The <code>Man</code> constructor calls its parent constructor sending a parameter (<code>name</code>) so the assignment is not broken. The <code>Man.prototype.say</code> overrides its parent <code>say</code> method so it can display a more specific message.</p>

		<div class="highlight"><pre><span class="c1">// create &quot;super class&quot;</span>
<span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m a Person, my name is:&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// create &quot;child class&quot; that will inherit from its parent</span>
<span class="kd">var</span> <span class="nx">Man</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Person</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span> <span class="c1">// call super constructor</span>
<span class="p">}</span>
<span class="nx">Man</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Person.prototype.say.call(this); // call super say method</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m a Man, my name is:&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// apply inheritance</span>
<span class="nx">soma</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="nx">Man</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>

<span class="c1">// create Person</span>
<span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="s2">&quot;Doe&quot;</span><span class="p">);</span>
<span class="nx">person</span><span class="p">.</span><span class="nx">say</span><span class="p">();</span>

<span class="c1">// create Man</span>
<span class="kd">var</span> <span class="nx">john</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Man</span><span class="p">(</span><span class="s2">&quot;John Doe&quot;</span><span class="p">);</span>
<span class="nx">john</span><span class="p">.</span><span class="nx">say</span><span class="p">();</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/IIHqPwNuikn5E7MoQoLM?preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<p>Here is a different syntax using an object to create the <code>Man</code> function. The result is exactly the same as the previous example.</p>

		<div class="highlight"><pre><span class="c1"><span class="c1">// create &quot;child class&quot; that will inherit from its parent</span>
<span class="c1">// apply inheritance using an object that will become the prototype</span>
<span class="kd">var</span> <span class="nx">Man</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Person</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span> <span class="c1">// call super constructor</span>
  <span class="p">},</span>
  <span class="nx">say</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Person.prototype.say.call(this); // call super say method</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m a Man, my name is:&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/atRF1AA5SRs5EnEhpFZV?preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Extend method shortcut</h2>
			<a class="anchor" name="extend-method-shortcut"></a>
		</div>

		<p>Here is small snippet to attach a method and easily apply inheritance on a function.</p>

		<div class="highlight"><pre><span class="c1">// create shortcut extend method</span>
<span class="nx">Person</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
<span class="p">};</span>
<span class="c1">// create &quot;child class&quot; using the extend shortcut</span>
<span class="kd">var</span> <span class="nx">Man</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

<span class="p">});</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/ipL2XpdgS6BvjVYJvcYD?preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Call super constructor and methods</h2>
			<a class="anchor" name="call-super-constructor-and-methods"></a>
		</div>

		<p>The way used to call a parent constructor and a method up in the prototypal chain in the previous example is the native javascript way of doing it.</p>

		<div class="highlight"><pre><span class="c1">// call parent constructor</span>
<span class="nx">ParentFunction</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">param</span><span class="p">);</span>
<span class="c1">// call parent prototype method</span>
<span class="nx">ParentFunction</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">myMethod</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">param</span><span class="p">);</span>
</pre></div>

		<p>soma offers a slightly different way of writing calls to the parents. Note that this syntax is not pure javascript, this is a soma enhancement, use it only if the application benefit of not writing the parent function name explicitly.</p>

		<div class="highlight"><pre><span class="c1">// call parent constructor</span>
<span class="nx">CurrentFunction</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">param</span><span class="p">);</span>
<span class="c1">// call parent prototype method</span>
<span class="nx">CurrentFunction</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">myMethod</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">param</span><span class="p">);</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/AFeM5fIlUlUO5OhKpI94?preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Plugins</h1>
			<a class="anchor" name="plugins"></a>
		</div>

		<p>soma provide an interface to create plugins to add new features to the framework.</p>
		<p>The <a href="http://soundstep.github.io/soma-template/" target="_blank">soma-template</a> plugin is a self-contained library with no dependency, but can also be added to soma as a plugin. soma-template is adding DOM manipulation capabilities and a custom method to create template directly in the framework (<code>instance.createTemplate</code>).</p>
		<p>A plugin is a function that can receive framework core elements and custom parameters. The plugin can be instantiated using the method <code>createPlugin</code>, the first parameter is the plugin function to be instantiated and the others parameters will be sent the plugin constructor.</p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Create a plugin</h2>
			<a class="anchor" name="create-a-plugin"></a>
		</div>

		<p>Plugins can be either dependent or independent to the framework, it is only a matter of choice. The following example show a simple structure to create a plugin.</p>

		<div class="highlight"><pre><span class="nt">&lt;script&gt;</span>
<span class="c1">// plugin</span>
<span class="kd">var</span> <span class="nx">Plugin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">,</span> <span class="nx">injector</span><span class="p">,</span> <span class="nx">customParameter</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// framework core elements can be injected as well custom parameters</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Plugin created with&#39;</span><span class="p">,</span> <span class="nx">customParameter</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create a plugin</span>
    <span class="kd">var</span> <span class="nx">plugin</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createPlugin</span><span class="p">(</span><span class="nx">Plugin</span><span class="p">,</span> <span class="s1">&#39;custom parameter&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/zpv15klrAJ2eTIRWGV6i?preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Mouse plugin</h2>
			<a class="anchor" name="mouse-plugin"></a>
		</div>

		<p>The following example creates a <code>MousePlugin</code> and an injection mapping rule so it can be used anywhere in the application. The MousePlugin provide a <code>getPosition</code> method to retrieve the mouse coordinates, as well as a dispose function to "destroy" the plugin.</p>
		<p>Providing a <code>dispose</code> method is a good practice to properly destroy an object. Listeners can be removed, internal objects can be destroyed, so the object can be <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Memory_Management" target="_blank">garbage collected</a>.</p>

		<div class="highlight"><pre><span class="c1">// plugin to retrieve the mouse coordinates</span>
<span class="kd">var</span> <span class="nx">MousePlugin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// object holding mouse position</span>
  <span class="kd">var</span> <span class="nx">position</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">};</span>
  <span class="c1">// event handler storing the mouse position</span>
  <span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
    <span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">//add event</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
  <span class="c1">// returns a getPosition method to retrieve the mouse position</span>
  <span class="c1">// returns a dispose method to remove the listener</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">getPosition</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">position</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">dispose</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// create the plugin</span>
<span class="kd">var</span> <span class="nx">mouse</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createPlugin</span><span class="p">(</span><span class="nx">MousePlugin</span><span class="p">);</span>
<span class="c1">// create a mapping rule</span>
<span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapValue</span><span class="p">(</span><span class="s1">&#39;mouse&#39;</span><span class="p">,</span> <span class="nx">mouse</span><span class="p">);</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/aGTAeUm42GxCGgA1RxVZ?preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Ready plugin (auto-registration)</h2>
			<a class="anchor" name="ready-plugin"></a>
		</div>

		<p>The following plugin (<code>ReadyPlugin</code>) alters the prototype of the soma application and add a <code>ready</code> method to it. The <code>ready</code> method is used to add callbacks for the application to know when the DOM has been fully loaded.</p>
		<p>An event could have been dispatched but for the sake of the demonstration. the application prototype has been altered to show a direct use of a plugin. The <code>ready</code> function is used both in the application instance and in the view.</p>
		<p>The plugin is also not created by the user application instance. The plugin is "auto-registered" and will be made available by the framework automatically. This makes the creation of a plugin possible without further actions, by executing its code, or by loading a javascript file containing the plugin.</p>

		<div class="highlight"><pre><span class="c1">// plugin to add callbacks when the dom is ready</span>
<span class="kd">var</span> <span class="nx">ReadyPlugin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ready function to add callbacks when the DOM is loaded (https://github.com/ded/domready)</span>
  <span class="kd">var</span> <span class="nx">ready</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="kd">function</span> <span class="nx">l</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="nx">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">shift</span><span class="p">();)</span><span class="nx">b</span><span class="p">()}</span><span class="kd">var</span> <span class="nx">b</span><span class="p">,</span><span class="nx">a</span><span class="o">=</span><span class="p">[],</span><span class="nx">c</span><span class="o">=!</span><span class="mi">1</span><span class="p">,</span><span class="nx">d</span><span class="o">=</span><span class="nb">document</span><span class="p">,</span><span class="nx">e</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span><span class="nx">f</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">doScroll</span><span class="p">,</span><span class="nx">g</span><span class="o">=</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span><span class="nx">h</span><span class="o">=</span><span class="s2">&quot;addEventListener&quot;</span><span class="p">,</span><span class="nx">i</span><span class="o">=</span><span class="s2">&quot;onreadystatechange&quot;</span><span class="p">,</span><span class="nx">j</span><span class="o">=</span><span class="s2">&quot;readyState&quot;</span><span class="p">,</span><span class="nx">k</span><span class="o">=</span><span class="sr">/^loade|c/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span><span class="k">return</span> <span class="nx">d</span><span class="p">[</span><span class="nx">h</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="nx">d</span><span class="p">[</span><span class="nx">h</span><span class="p">](</span><span class="nx">g</span><span class="p">,</span><span class="nx">b</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">),</span><span class="nx">l</span><span class="p">()},</span><span class="nx">c</span><span class="p">),</span><span class="nx">f</span><span class="o">&amp;&amp;</span><span class="nx">d</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">b</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="sr">/^c/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">j</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">b</span><span class="p">),</span><span class="nx">l</span><span class="p">())}),</span><span class="nx">f</span><span class="o">?</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="nx">self</span><span class="o">!=</span><span class="nx">top</span><span class="o">?</span><span class="nx">k</span><span class="o">?</span><span class="nx">b</span><span class="p">()</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">try</span><span class="p">{</span><span class="nx">e</span><span class="p">.</span><span class="nx">doScroll</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="k">return</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">ready</span><span class="p">(</span><span class="nx">b</span><span class="p">)},</span><span class="mi">50</span><span class="p">)}</span><span class="nx">b</span><span class="p">()}()}</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="nx">k</span><span class="o">?</span><span class="nx">b</span><span class="p">()</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">b</span><span class="p">)}}();</span>
  <span class="c1">// add the ready function to the prototype of the soma application for a direct use</span>
  <span class="nx">instance</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="nx">ready</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// auto-registration, the plugin will be instantiated automatically by soma</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">soma</span><span class="p">.</span><span class="nx">plugins</span> <span class="o">&amp;&amp;</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">add</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">soma</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">ReadyPlugin</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// view</span>
<span class="kd">var</span> <span class="nx">View</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">instance</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;DOM is loaded&#39;</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// use the plugin</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DOM READY&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create a view</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">View</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.report&#39;</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/oTsfM594TXVKo1HmROLL?preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Orientation plugin</h2>
			<a class="anchor" name="orientation-plugin"></a>
		</div>

		<p>The role of the following plugin (<code>OrientationPlugin</code>), is to detect an orientation change on a mobile device, either portait or landscape. The orientation can be retrieve at any moment from the plugin, but the plugin will also dispatch an event when the device orientation changes. This makes possible for another entities to simply listen to this events to update its state.</p>

		<div class="highlight"><pre><span class="c1">// plugin to retrieve the mouse coordinates</span>
<span class="kd">var</span> <span class="nx">OrientationPlugin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dispatcher</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// hold current orientation</span>
  <span class="kd">var</span> <span class="nx">orientation</span> <span class="o">=</span> <span class="nx">detectDeviceOrientation</span><span class="p">();</span>
  <span class="c1">// add listener to detect orientation change</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;orientationchange&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
  <span class="c1">// store the new orientation and dispatch an event</span>
  <span class="kd">function</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">orientation</span> <span class="o">=</span> <span class="nx">detectDeviceOrientation</span><span class="p">();</span>
    <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="nx">orientation</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// return the orientation, portait or landscape</span>
  <span class="kd">function</span> <span class="nx">detectDeviceOrientation</span><span class="p">(){</span>
    <span class="k">switch</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">orientation</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="mi">90</span><span class="o">:</span>
      <span class="k">case</span> <span class="o">-</span><span class="mi">90</span><span class="o">:</span>
        <span class="k">return</span> <span class="s1">&#39;landscape&#39;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
      <span class="k">case</span> <span class="mi">180</span><span class="o">:</span>
      <span class="k">default</span><span class="o">:</span>
        <span class="k">return</span> <span class="s1">&#39;portait&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// return plugin API</span>
  <span class="c1">// getOrientation returns either landscape or portait</span>
  <span class="c1">// dispose removes the listener</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">getOrientation</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">orientation</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">dispose</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;orientationchange&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// view</span>
<span class="kd">var</span> <span class="nx">View</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">,</span> <span class="nx">orientation</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// display the orientation when the view is created</span>
  <span class="nx">updateOrientation</span><span class="p">(</span><span class="nx">orientation</span><span class="p">.</span><span class="nx">getOrientation</span><span class="p">());</span>
  <span class="c1">// listen to the event dispatched by the plugin</span>
  <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// display the orientation when a change happened</span>
    <span class="nx">updateOrientation</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="c1">// display the orientation in the DOM Element</span>
  <span class="kd">function</span> <span class="nx">updateOrientation</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;Current orientation: &#39;</span> <span class="o">+</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create the plugin</span>
    <span class="kd">var</span> <span class="nx">plugin</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createPlugin</span><span class="p">(</span><span class="nx">OrientationPlugin</span><span class="p">);</span>
    <span class="c1">// create a mapping rule</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapValue</span><span class="p">(</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="nx">plugin</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create a view</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">View</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.report&#39;</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
</pre></div>

		<p><a href="http://run.plnkr.co/plunks/qJthopgArZx8t5yusxKn/" class="button icon edit" target="_blank">Test on a mobile device</a></p>
		<p><a href="http://plnkr.co/edit/qJthopgArZx8t5yusxKn?preview" class="button icon edit" target="_blank">Try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Router</h1>
			<a class="anchor" name="router"></a>
		</div>

		<p>soma does not provide a built-in router to take care of path and url. However, <a href="https://github.com/flatiron/director" target="_blank">Director</a> is a great library that is focused on routing.</p>
		<p>The library is very featured, fully tested, does not have any dependency and can be seamlessly integrated in the framework. Director also support the <a href="https://github.com/flatiron/director#history-api" target="_blank">HTML 5 history API</a>.</p>

		<p><a href="https://github.com/flatiron/director" class="button icon tag" target="_blank">Get Director</a></p>

		<p><a href="../demos/todo-hash" target="_blank">Click here to see the todo app</a> that integrates Director.</p>

		<p>Here is a simple example to implement Director in a soma application.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Navigation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">router</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// setup routes and dispatch views ids</span>

  <span class="nx">router</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">);</span>

  <span class="nx">router</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dispatchRoute</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">router</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;/page1&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dispatchRoute</span><span class="p">(</span><span class="s1">&#39;page1&#39;</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">router</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;/page2&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dispatchRoute</span><span class="p">(</span><span class="s1">&#39;page2&#39;</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="c1">// in this demo, all routes could have been handled with this single regex route</span>
  <span class="c1">// router.on(/.*/, function() {</span>
  <span class="c1">//   dispatchRoute(router.getRoute()[0]);</span>
  <span class="c1">// });</span>

  <span class="kd">function</span> <span class="nx">dispatchRoute</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">&#39;show-view&#39;</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">};</span>

<span class="kd">var</span> <span class="nx">View</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;show-view&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">isCurrentView</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="nx">isCurrentView</span> <span class="o">?</span> <span class="s1">&#39;block&#39;</span> <span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create the Director router and make it available through the framework</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapValue</span><span class="p">(</span><span class="s1">&#39;router&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">());</span>
    <span class="c1">// create mediators for the views (DOM Element)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">View</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;.view&#39;</span><span class="p">))</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// instantiate Navigation to start the app</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">createInstance</span><span class="p">(</span><span class="nx">Navigation</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
</pre></div>


		<p><a href="http://plnkr.co/edit/7QwQFHhITvXN9U7zkfcW?preview" class="button icon edit" target="_blank">Try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Demos</h1>
			<a class="anchor" name="demos"></a>
		</div>

		<ul>
			<li>
				<a href="../demos/helloworld" target="_blank">Hello world</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/helloworld" target="_blank">view source</a>)
				<p>Demo displaying a string. The application contains a model, a mediator and uses an event to display the string in a DOM Element.</p>
			</li>
			<li>
				<a href="../demos/twitter" target="_blank">Twitter search</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/twitter" target="_blank">view source</a>)
				<p>Demo searching in the Twitter API and displaying a list of tweets. The search is performed using a command and a service to get data from a remote location. The result is displayed in the DOM with the soma-template plugin.</p>
			</li>
			<li>
				<a href="../demos/todo" target="_blank">Todo app</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/todo" target="_blank">view source</a>)
				<p>Demo managing a list to todo items that can be added, removed, set as completed, and stored in the local storage. The application contains a model holding the data, a view using soma-template and a command to handle the different type of user events.</p>
			</li>
			<li>
				<a href="../demos/todo-light" target="_blank">Todo app light</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/todo-light" target="_blank">view source</a>)
				<p>Same todo app demo with a much lighter code. There's no command and no model API. The view updates the set of data directly using the soma-template function calls capability.</p>
			</li>
			<li>
				<a href="../demos/todo-hash" target="_blank">Todo app light with router</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/todo-hash" target="_blank">view source</a>)
				<p>Another version of the todo app light, with routes to filter the completed and active todo items. Director.js has been used as a router.</p>
			</li>
			<li>
				<a href="../demos/sniply" target="_blank">Sniply</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/sniply" target="_blank">view source</a>)
				<p>A complex web app that manage a list of snippets that are saved both in the local storage and on a remote server. The application can sign to the Github API (oauth 2.0) and is composed of a config, commands, models, a service, several views and some utils methods.</p>
			</li>
			<li>
				<a href="../demos/snake" target="_blank">Snake game</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/snake" target="_blank">view source</a>)
				<p>Snake game drawn into a canvas. It contains a canvas mediator, several models, layers, and game entities.</p>
			</li>
			<li>
				<a href="../demos/clock" target="_blank">Clock</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/clock" target="_blank">view source</a>)
				<p>Demo displaying three interchangeable views (digital, analog and polar clocks), using the same model and mediators.</p>
			</li>
			<li>
				<a href="../demos/clock-typescript" target="_blank">Clock TypeScript</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/clock-typescript" target="_blank">view source</a>)
				<p>TypeScript version of the javascript clock demo. The model and the views are abstracted using interfaces.</p>
			</li>
			<li>
				<a href="../demos/clock-coffeescript" target="_blank">Clock CoffeeScript</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/clock-coffeescript" target="_blank">view source</a>)
				<p>CoffeeScript version of the javascript clock demo.</p>
			</li>
			<li>
				<a href="../demos/orientation" target="_blank">Orientation plugin</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/orientation" target="_blank">view source</a>)
				<p>Demo using a custom mobile plugin that dispatches events on a device orientation change (portrait and landscape).</p>
			</li>
			<li>
				<a href="../demos/router" target="_blank">Router with Director</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/router" target="_blank">view source</a>)
				<p>Demo using the recommended router library: <a href="https://github.com/flatiron/director" target="_blank">Director.js</a>.</p>
			</li>
			<li>
				<a href="http://somajs-nodejs-demo.eu01.aws.af.cm/node.js" target="_blank">Node.js</a> (<a href="https://github.com/soundstep/soma/tree/master/demos/nodejs" target="_blank">view source</a>)
				<p>Demo creating a server (express), commands, templates and models to get started with soma on node.js.</p>
			</li>
		</ul>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Tools</h1>
			<a class="anchor" name="tools"></a>
		</div>

		<p>soma is very lightweight and some tools might be needed to performed some actions, such as handling routes in a one-page application, making DOM manipulations or making ajax requests.</p>
		<p>Developers are free to use the libraries they like but here are some recommended libraries that are very efficient and well-tested.</p>

		<p><h4>Router</h4></p>

		<ul>
			<li><a href="https://github.com/flatiron/director" target="_blank">Director</a></li>
		</ul>

		<p><h4>Ajax requests</h4></p>

		<ul>
			<li><a href="https://github.com/ded/reqwest" target="_blank">Reqwest</a></li>
			<li><a href="http://api.jquery.com/jQuery.ajax/" target="_blank">jQuery</a></li>
		</ul>

		<p><h4>DOM manipulation</h4></p>

		<ul>
			<li><a href="http://soundstep.github.io/soma-template/" target="_blank">soma-template</a> (plugin)</li>
			<li><a href="http://handlebarsjs.com/" target="_blank">Handlebars</a></li>
		</ul>

		<p><h4>DOM selector</h4></p>

		<ul>
			<li><a href="https://github.com/ded/qwery" target="_blank">Qwery</a></li>
			<li><a href="http://zeptojs.com/" target="_blank">Zepto</a> (mobile)</li>
			<li><a href="http://jquery.com/" target="_blank">jQuery</a></li>
		</ul>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Tests</h1>
			<a class="anchor" name="tests"></a>
		</div>

		<p>soma, as well its internal libraries (infuse.js, soma-events and soma-template), are all fully tested. There is no such a thing as a bug-free library, if something does not work as intended, Github is the best place to report it.</p>

		<ul>
			<li><a href="../tests" target="_blank">soma tests</a></li>
			<li><a href="http://soundstep.github.io/soma-template/tests/" target="_blank">soma-template tests</a> (<a href="http://soundstep.github.io/soma-template/tests/internal.html" target="_blank">internal tests</a>)</li>
			<li><a href="https://github.com/soundstep/soma-events/tree/master/tests" target="_blank">soma-events tests</a></li>
			<li><a href="https://github.com/soundstep/infuse.js/tree/master/tests" target="_blank">infuse.js tests</a></li>
		</ul>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section class="last">

		<div class="title">
			<h1>Browser support</h1>
			<a class="anchor" name="browser-support"></a>
		</div>

		<p>soma and its internal libraries (infuse.js, soma-events and soma-template) support all browsers and should work anywhere, with the exception of Internet Explorer 6.</p>

		<div class="back"><a href="#">top</a></div>

	</section>


</div>

<script src="assets/js/libs/jquery-1.8.2.min.js"></script>
<script src="assets/js/libs/modernizr.js"></script>
<script src="assets/js/libs/scale.fix.js"></script>
<script src="assets/js/app.js"></script>

</body>
</html>
